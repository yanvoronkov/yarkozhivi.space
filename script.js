// --- ДАННЫЕ КВИЗА ---
// Вам нужно будет заполнить все 12 блоков настоящими вопросами.
// В каждом блоке должно быть по 10 вопросов.
const quizData = {
	blocks: [
		{
			title: "Отверженность",
			questions: [
				"Я опасаюсь, что близкие уйдут из моей жизни.",
				"Мне трудно надеяться — это кажется наивным.",
				"Я очень тоскую, когда близкого человека нет рядом.",
				"Я постоянно влюбляюсь в людей, неспособных на серьезные отношения.",
				"Я часто беспокоюсь, что люди, которых я люблю, найдут кого-то, кто им больше понравится, и бросят меня.",
				"Я фактически росла без родителя (умер или отсутствовал физически).",
				"Я слишком сильно нуждаюсь в других людях, чтобы со мной были рядом.",
				"Я так боюсь, что люди бросят меня, что своими действиями отталкиваю их.",
				"Я впадаю в отчаяние, когда кто-то, кого я люблю, отдаляется от меня.",
				"В конце концов я останусь в одиночестве."
			]
		},
		{
			title: "Недоверчивость",
			questions: [
				"Мне нужно защищать себя самой и всегда быть начеку.",
				"Близкие люди несколько раз меня предавали, унижали или глубоко оскорбляли.",
				"Если я не буду осторожнее, люди станут использовать меня в своих интересах.",
				"Пройдет какое-то время, и люди, которых я люблю, предадут меня.",
				"Я боюсь подпускать людей близко, потому что не хочу, чтобы мне причинили боль.",
				"Я стараюсь обидеть людей до того, как они ранят меня.",
				"Я часто сомневаюсь в мотивах действий других людей.",
				"Я ожидаю, что люди обидят или используют меня.",
				"Я злюсь, когда думаю о том, как плохо со мной обращались.",
				"Я подвергалась физическому, эмоциональному или сексуальному насилию от тех, кто должен был заботиться обо мне."
			]
		},
		{
			title: "Несостоятельность",
			questions: [
				"У меня нет «достаточно весомых» достижений.",
				"Я сдаюсь раньше времени.",
				"Я малого достигла, и мне стыдно за это.",
				"Большинство других людей талантливее меня, например в семейной жизни, работе и учебе.",
				"Я не достаточно компетентна, как большинство людей в моей профессиональной области.",
				"Большинство людей достигает лучших результатов в работе.",
				"У меня часто нет сил бороться за свои цели.",
				"Я испытываю унижение от своих неудач.",
				"Я способна на большее.",
				"Я боюсь, что люди увидят, какая я глупая."
			]
		},
		{
			title: "Самопожертвование",
			questions: [
				"Мои отношения страдают из-за того, что я так много работаю.",
				"Моё здоровье страдает из-за того, что я уделяю работе слишком много времени.",
				"Я чувствую себя виноватой, когда расстраиваю других людей.",
				"Я испытываю чувство вины, если ставлю в приоритет свои нужды.",
				"Я именно тот, кто заботится о близких людях.",
				"Я хороший человек, потому что думаю о других больше, чем о себе.",
				"Вне зависимости от уровня занятости, я всегда нахожу время для других людей.",
				"Я умею обходиться малым.",
				"Мне сложно принять заботу — я сразу думаю, чем «отплатить».",
				"Мне приятнее дарить, чем принимать подарки."
			]
		},
		{
			title: "Отчужденность",
			questions: [
				"Я чувствую, что не вписываюсь в большинство коллективов.",
				"Моя семья отличалась от других семей.",
				"Люди редко принимают меня за свою.",
				"Я чувствую себя скучной и унылым на вечеринках и в других группах людей.",
				"Я теряюсь, когда мне нужно что-то сказать на аудиторию.",
				"Я предпочитаю избегать мероприятий и дел, которые требуют общения с людьми.",
				"Те, кого я хочу видеть своими друзьями, превосходят меня (статусом, внешностью, интеллектуально).",
				"Я чувствую, что сильно отличаюсь от других людей.",
				"Я чувствую себя хуже других, непривлекательной- слишком полной/худой, высокой/низкой, не стильной т. д.",
				"В целом я чувствую себя оторванной от общества."
			]
		},
		{
			title: "Недисциплинированность",
			questions: [
				"Мне сложно доводить начатое до конца.",
				"Я часто делаю то, что хочется «прямо сейчас».",
				"У меня срывы — в еде, покупках, эмоциях.",
				"Я не люблю рамки и правила.",
				"Я легко отказываюсь от плана, если становится трудно.",
				"Я быстро устаю и бросаю.",
				"Я часто жалею о спонтанных решениях.",
				"Я не умею себя организовать.",
				"Я легко раздражаюсь, если не по-моему.",
				"Мне трудно придерживаться режима, целей, решений."
			]
		},
		{
			title: "Недолюбленность",
			questions: [
				"Я не получаю от близких столько тепла, сколько мне нужно.",
				"Мне тяжело позволить людям любить меня.",
				"Меня часто привлекают равнодушные партнеры, неспособные удовлетворить мои нужды.",
				"В моей жизни не было ни одного любимого человека, который посвящал бы себя мне и был бы неравнодушен к тому, что со мной происходит.",
				"Мне тяжело позволить людям заботиться или защищать меня, хотя в душе я хочу именно этого.",
				"Я не получаю достаточно объятий, ласки и любви в близких отношениях.",
				"Я привыкла справляться одна.",
				"Мой партнер или члены семьи не понимают, чего мне «постоянно не хватает».",
				"Мне часто бывает одиноко.",
				"У меня нет никого, кто мог бы по-настоящему выслушать меня и понять мои настоящие чувства и потребности."
			]
		},
		{
			title: "Перфекционизм",
			questions: [
				"Я должна быть лучшей во всем, что я делаю, и не могу быть хуже других.",
				"Мне всегда важно выглядеть наилучшим образом.",
				"Я стараюсь держать почти все в идеальном порядке.",
				"У меня так много дел, что почти нет времени, чтобы по-настоящему расслабиться.",
				"Моя личная жизнь страдает, потому что я слишком требовательна к себе и другим.",
				"Почти ничего из того, что я делаю, не является достаточно хорошим; я всегда могу сделать лучше.",
				"Я часто жертвую удовольствием и счастьем, чтобы соответствовать собственным стандартам.",
				"Мое здоровье страдает, потому что я испытываю сильное напряжение.",
				"Я стараюсь делать все как можно лучше и не приемлю, когда говорят, что «и так уже достаточно хорошо».",
				"Богатство и статус для меня очень важны."
			]
		},
		{
			title: "Надменность",
			questions: [
				"Мне очень трудно принять «нет» в качестве ответа, когда я чего-то хочу от других людей.",
				"Я требую, чтобы люди поступали так, как я хочу.",
				"Я считаю, что заслуживаю особого отношения.",
				"Я ненавижу, когда меня ограничивают или мешают делать то, что я хочу.",
				"Я ставлю свои нужды на первое место.",
				"Мне очень трудно заставить себя бросить вредные привычки или иначе скорректировать свое поведение.",
				"Я не могу заставить себя делать скучную или рутинную работу.",
				"Я действую импульсивно и потом испытываю проблемы из-за своих эмоций.",
				"Если я не могу достичь цели, я легко раздражаюсь и сдаюсь.",
				"Мне трудно отказаться от мгновенного вознаграждения, чтобы достичь долгосрочной цели."
			]
		},
		{
			title: "Пессимизм",
			questions: [
				"Я склонна делать пессимистичные прогнозы.",
				"Иногда мне тяжело спать от беспокойства по поводу возможных событий.",
				"Когда люди рассказывают мне об идеях или проектах, мне хочется предупредить их о том, что может пойти не так.",
				"Я стараюсь быть реалистом.",
				"Я часто чувствую себя бессильной перед обстоятельствами.",
				"Я тревожный человек.",
				"Меня очень беспокоят плохие новости: преступность, проблемы окружающей среды и так далее.",
				"Лучше заранее ожидать плохое, чтобы не разочароваться.",
				"Я всегда замечаю, что может пойти не так — и обычно так и происходит.",
				"Если случается что-то хорошее, я боюсь, что за этим последует плохое событие."
			]
		},
		{
			title: "Неполноценность",
			questions: [
				"Я виновата в том, что родители меня не любили. Это со мной что-то не так.",
				"Как бы я ни старалась, я чувствую, что не смогу добиться уважения и признания со стороны важного для меня человека.",
				"Я не заслуживаю любви, внимания и уважения других.",
				"У меня есть секреты, которыми я не хочу делиться даже с самыми близкими людьми.",
				"Если бы другие узнали о моих недостатках, мне было бы ужасно стыдно.",
				"Я не открываюсь до конца и скрываю себя настоящую.",
				"У меня были отношения, в которых мне постоянно говорили, что я все делаю не так.",
				"Ни один человек не полюбит меня, если узнает меня настоящую.",
				"Я обесцениваю свои положительные качества.",
				"Я сама часто критикую и отвергаю себя, особенно перед теми, кто, кажется, меня любит."
			]
		},
		{
			title: "Сдержанность",
			questions: [
				"Я чувствую, что должна контролировать свои эмоции и импульсы.",
				"Я воспринимаю жизнь как борьбу, где все дается с трудом.",
				"Мне сложно быть спонтанной — я всё планирую заранее.",
				"Я себя контролирую настолько, что кажусь окружающим равнодушной.",
				"Я боюсь показаться нелепой и смешной.",
				"Я не знаю как и стесняюсь проявлять симпатию и заботу.",
				"Говорят, что я слишком серьезная, редко смеюсь или позволяю себе просто веселиться.",
				"Мне сложно флиртовать, шутить, быть легкой в общении.",
				"Внутри накапливается много гнева и обиды, которых я не выражаю.",
				"Я чувствую себя уставшей от того, что должна быть «собранной» всё время."
			]
		}
	]
};

class Quiz {
	constructor() {
		this.allQuestions = [];
		this.currentQuestionIndex = 0;
		this.results = [];
		this.chart = null; // Для хранения экземпляра диаграммы

		this.initializeElements();
		this.attachEventListeners();
	}

	// Находим все необходимые элементы на странице
	initializeElements() {
		this.welcomeScreen = document.getElementById('welcome-screen');
		this.quizScreen = document.getElementById('quiz-screen');
		this.finalResultsScreen = document.getElementById('final-results');
		this.startButton = document.getElementById('start-quiz');
		this.restartButton = document.getElementById('restart-quiz');

		this.currentQuestionElement = document.getElementById('current-question');
		this.questionContainer = document.querySelector('.question-container');
		this.questionCounter = document.getElementById('question-counter');

		this.answerButtons = document.querySelectorAll('.answer-btn');
		this.progressBar = document.querySelector('.progress');
		// Просто находим элемент canvas, контекст получим позже.
		// Это делает код более устойчивым к ошибкам при загрузке.
		this.resultsChartCanvas = document.getElementById('results-chart');
	}

	// Назначаем обработчики событий кнопкам
	attachEventListeners() {
		this.startButton.addEventListener('click', () => this.startQuiz());
		this.restartButton.addEventListener('click', () => this.restartQuiz());
		this.answerButtons.forEach(button => {
			button.addEventListener('click', (e) => this.handleAnswer(e));
		});
	}

	// Запуск квиза
	startQuiz() {
		this.prepareQuestions();
		this.results = new Array(quizData.blocks.length).fill(0);
		this.currentQuestionIndex = 0;

		this.welcomeScreen.classList.remove('active');
		this.finalResultsScreen.classList.remove('active');
		this.quizScreen.classList.add('active');

		this.showCurrentQuestion();
	}

	// Перезапуск квиза
	restartQuiz() {
		if (this.chart) {
			this.chart.destroy();
		}
		this.startQuiz();
	}

	// Подготовка вопросов: собираем все в один массив и перемешиваем
	prepareQuestions() {
		this.allQuestions = [];
		quizData.blocks.forEach((block, blockIndex) => {
			block.questions.forEach(questionText => {
				this.allQuestions.push({
					text: questionText,
					blockIndex: blockIndex
				});
			});
		});

		// Перемешиваем массив вопросов (алгоритм Фишера-Йейтса)
		for (let i = this.allQuestions.length - 1; i > 0; i--) {
			const j = Math.floor(Math.random() * (i + 1));
			[this.allQuestions[i], this.allQuestions[j]] = [this.allQuestions[j], this.allQuestions[i]];
		}
	}

	// Отображение текущего вопроса
	showCurrentQuestion() {
		this.questionContainer.classList.remove('visible');

		setTimeout(() => {
			if (this.currentQuestionIndex < this.allQuestions.length) {
				const question = this.allQuestions[this.currentQuestionIndex];

				this.currentQuestionElement.textContent = question.text;
				this.questionCounter.textContent = `Вопрос ${this.currentQuestionIndex + 1} из ${this.allQuestions.length}`;

				this.resetAnswerButtons();
				this.updateProgress();

				this.questionContainer.classList.add('visible');
			} else {
				this.showFinalResults();
			}
		}, 300);
	}

	// Сбрасываем выделение кнопок ответа
	resetAnswerButtons() {
		this.answerButtons.forEach(btn => btn.classList.remove('selected'));
	}

	// Обработка ответа пользователя
	handleAnswer(event) {
		const value = parseInt(event.target.dataset.value, 10);
		const currentQuestionData = this.allQuestions[this.currentQuestionIndex];

		this.results[currentQuestionData.blockIndex] += value;

		event.target.classList.add('selected');

		setTimeout(() => {
			this.currentQuestionIndex++;
			this.showCurrentQuestion();
		}, 400);
	}

	// Обновление полосы прогресса
	updateProgress() {
		const progressPercentage = ((this.currentQuestionIndex) / this.allQuestions.length) * 100;
		this.progressBar.style.width = `${progressPercentage}%`;
	}

	// Отображение финальных результатов
	showFinalResults() {
		this.quizScreen.classList.remove('active');
		this.finalResultsScreen.classList.add('active');
		// Обновляем прогресс до 100% в конце
		this.progressBar.style.width = `100%`;

		this.createChart();
	}

	// Создание диаграммы результатов
	createChart() {
		const labels = quizData.blocks.map(block => block.title);
		const data = this.results;
		const ctx = this.resultsChartCanvas.getContext('2d');

		// Определяем массив цветов для каждого блока.
		// Вы можете заменить эти цвета на любые другие в формате HEX (#RRGGBB) или RGBA.
		const backgroundColors = [
			'rgba(255, 99, 132, 0.8)',
			'rgba(54, 162, 235, 0.8)',
			'rgba(255, 206, 86, 0.8)',
			'rgba(75, 192, 192, 0.8)',
			'rgba(153, 102, 255, 0.8)',
			'rgba(255, 159, 64, 0.8)',
			'rgba(139, 195, 74, 0.8)',
			'rgba(25, 130, 196, 0.8)',
			'rgba(106, 76, 147, 0.8)',
			'rgba(249, 87, 56, 0.8)',
			'rgba(0, 168, 150, 0.8)',
			'rgba(229, 107, 111, 0.8)'
		];

		// Делаем цвета границ непрозрачными
		const borderColors = backgroundColors.map(color => color.replace('0.8', '1'));

		this.chart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: labels,
				datasets: [{
					label: 'Баллы',
					data: data,
					// Используем массивы цветов для заливки и границ
					backgroundColor: backgroundColors,
					borderColor: borderColors,
					borderWidth: 1,
					borderRadius: 5,
					borderSkipped: false,
				}]
			},
			options: {
				indexAxis: 'y',
				responsive: true,
				maintainAspectRatio: false,
				plugins: {
					legend: {
						display: false
					},
					tooltip: {
						enabled: true
					}
				},
				scales: {
					x: {
						beginAtZero: true,
						max: 50, // Максимум 10 вопросов * 5 баллов
						grid: {
							display: false
						},
						ticks: {
							font: {
								size: 14
							}
						}
					},
					y: {
						grid: {
							display: false
						},
						ticks: {
							font: {
								size: 14
							}
						}
					}
				}
			}
		});
	}
}

// Инициализация квиза при загрузке страницы
document.addEventListener('DOMContentLoaded', () => {
	new Quiz();
});
